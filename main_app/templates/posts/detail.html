{% extends "base.html" %}
{% load static %}
{% block page_content %}
  <article class="post-detail">
    <header class="post-detail-header">
      {% if post.program_type %}<span class="post-program-badge">{{ post.program_type }}</span>{% endif %}
      <h1 class="post-detail-title">{{ post.title }}</h1>
      <div class="post-detail-meta">
        {% if post.user.profile.first_name %}
          <span class="post-author">By {{ post.user.profile.first_name }}{% if post.user.profile.last_name %} {{ post.user.profile.last_name|slice:":1" }}.{% endif %}</span>
        {% else %}
          <span class="post-author">By {{ post.user.username }}</span>
        {% endif %}
        <span class="text-secondary">•</span>
        <span class="text-secondary text-sm">{{ post.created_at|date:"M d, Y" }}</span>
        {% if post.grad_year %}
          <span class="text-secondary">•</span>
          <span class="post-grad-year">Class of {{ post.grad_year }}</span>
        {% endif %}
      </div>
    </header>
    <div class="post-detail-body">
      <p class="post-detail-description">{{ post.description }}</p>
      {% if post.linkedin_url %}
        <div class="post-detail-links">
          <a href="{{ post.linkedin_url }}"
             target="_blank"
             rel="noopener noreferrer"
             class="btn btn-outline">
            <svg xmlns="http://www.w3.org/2000/svg"
                 width="20"
                 height="20"
                 viewBox="0 0 24 24"
                 fill="currentColor">
              <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z" />
            </svg>
            Connect on LinkedIn
          </a>
        </div>
      {% endif %}
    </div>

    <!-- Post Actions: separated from comments -->

    <div class="post-actions mb-4" style="display: flex; justify-content: space-between; align-items: center; gap: 1rem;">
      <a href="{% url 'post_index' %}" class="btn btn-ghost">← Back to Community</a>
      <span>
        {% if user == post.user %}
          <a href="{% url 'post_update' post.id %}" class="btn btn-outline">Edit</a>
          <a href="{% url 'post_delete' post.id %}" class="btn btn-danger">Delete</a>
        {% endif %}
      </span>
    </div>

    <section class="comments-section">
      <div class="card comments-card mt-4">
        <h2>Comments ({{ post.comments.count }})</h2>
        <div class="comment-form">
          <form method="post" action="{% url 'comment_create' post.id %}">
            {% csrf_token %}
            <textarea name="content" rows="3" placeholder="Write a comment..." required></textarea>
            <button type="submit" class="btn btn-primary">Post Comment</button>
          </form>
          <br/>
        </div>
        <div class="comments-list">
          {% for comment in post.comments.all %}
            <div class="comment">
              <div class="comment-header">
              <strong>
                {% if comment.user.profile.first_name %}
                  {{ comment.user.profile.first_name }}{% if comment.user.profile.last_name %} {{ comment.user.profile.last_name|slice:':1' }}.{% endif %}
                {% else %}
                  {{ comment.user.username }}
                {% endif %}
              </strong>
              <small class="comment-date">{{ comment.created_at }}</small>
              </div>
              <div class="comment-body">
                {{ comment.content }}
              </div>
            </div>
          {% empty %}
            <p class="no-comments">No comments yet. Be the first to comment!</p>
          {% endfor %}
        </div>
      </div>
    </section>
  </article>
    </footer>
  </article>
{% endblock page_content %}
